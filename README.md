# BDD Specs

# ストーリー
ユーザがqiitaの一覧情報を見たいとリクエストする

## 物語1
Who:オンラインのユーザーは
What:最新のデータをアプリに自動で取得して欲しい。
Why:なぜなら、いつでも最新の情報をチェックできるからだ。

## シナリオ
Given:ユーザがオンラインの状態にある時に
When:qiita情報の一覧を見たいとリクエストすると
Then:アプリはリモートから最新のqiitaの情報を表示してキャッシュを新しい情報と入れ替える。

Given:ユーザがオンラインの状態で画面を表示している時に
When:取得しているデータの続きのqiita情報の一覧を見たいとリクエストすると
Then:アプリはリモートから取得済みのデータの次に最新のqiitaの情報を取得してキャッシュにも追加する

## 物語2
Who:オフラインのユーザーは
What:最新のキャッシュデータをアプリに自動で取得して欲しい。
Why:なぜなら、いつでも取得可能な最新の情報をチェックできるからだ。

## シナリオ
Given:ユーザがオフラインの状態にあり、有効期限内のキャッシュが存在する場合
When:qiita情報の一覧を見たいとリクエストすると
Then:アプリはキャッシュ上の最新のqiitaの情報を表示する

Given:ユーザがオフラインの状態にあり、有効期限が切れたキャッシュが存在する場合
When:qiita情報の一覧を見たいとリクエストすると
Then:アプリはデータがない時のメッセージを表示する

Given:ユーザがオフラインの状態にあり、キャッシュが存在しない場合
When:qiita情報の一覧を見たいとリクエストすると
Then:アプリはデータがない時のメッセージを表示する

Given:ユーザがオフラインの状態で画面を表示している時に
When:取得しているデータの続きのqiita情報の一覧を見たいとリクエストすると
Then:アプリはキャッシュ上の取得済みのデータの次に最新のqiitaの情報を取得する

# ユースケース

## リモートからqiita情報を取得

### Data: 
- URL

### Happy Path:
1. dataを使って「qiita情報を取得する」コマンドを実行する
1. システムがURLからデータをダウンロードする
1. システムがダウンロードデータをバリデーションする
1. システムが妥当なデータからqiita情報を作成する
1. システムがqiita情報を伝達する

### Invalid data(sad path):
1. システムからinvalid data errorを伝達する

### No connectivity(sad path):
1. システムからconnectivity errorを伝達する

---

## リモートからqiitaユーザの画像を取得

### Data: 
- URL

### Happy Path:
1. dataを使って「qiitaユーザの画像を取得する」コマンドを実行する
1. システムがURLからデータをダウンロードする
1. システムがダウンロードデータをバリデーションする
1. システムが画像データを伝達する

### Invalid data(sad path):
1. システムからinvalid data errorを伝達する

### No connectivity(sad path):
1. システムからconnectivity errorを伝達する

---

## キャッシュからqiita情報を取得

### Data: 

### Happy Path:
1. 「qiita情報を取得する」コマンドを実行する
1. システムがキャッシュからデータを取得する
1. システムがキャッシュが有効期限内であるかをバリデーションする
1. システムがキャッシュからqiita情報を作成する
1. システムがqiita情報を伝達する

###  取得に失敗(sad path):
1. システムからerrorを伝達する

### キャッシュの有効期限切れ(sad path):
1. システムからデータがないことを伝達する

### キャッシュが空(sad path):
1. システムからデータがないことを伝達する

---

## キャッシュからqiitaユーザの画像を取得

### Data: 
- URL

### Happy Path:
1. dataを使って「qiitaユーザの画像を取得する」コマンドを実行する
1. システムがキャッシュからデータを取得する
1. システムが画像データを伝達する

### キャンセルされた場合:
1. システムはデータもエラーも送らない

###  取得に失敗(sad path):
1. システムからerrorを伝達する

### キャッシュが空(sad path):
1. システムからnot found errorを伝達する

---

## qiita情報のキャッシュのバリデーション

### Happy Path:
1. 「キャッシュをバリデーションする」コマンドを実行する
2. システムがキャッシュからデータを取得する
3. システムがキャッシュが有効期限内かどうかをチェックする

###  取得に失敗(sad path):
1. システムがキャッシュを削除する

### キャッシュの有効期限切れ(sad path):
1. システムがキャッシュを削除する

---

## qiitaのユーザ画像のキャッシュのバリデーション

### Happy Path:
1. 「キャッシュをバリデーションする」コマンドを実行する
2. システムがキャッシュからデータを取得する
3. システムがキャッシュが有効期限内かどうかをチェックする

###  取得に失敗(sad path):
1. システムがキャッシュを削除する

### キャッシュの有効期限切れ(sad path):
1. システムがキャッシュを削除する

---

## qiita情報をキャッシュする

### Data
- qiita情報

### Happy Path:
1. 「キャッシュを保存する」コマンドを実行する
1. システムが古いキャッシュを削除する
1. システムがキャッシュをエンコードする
1. システムが新しいキャッシュにタイムスタンプを押す
1. システムが新しいキャッシュを保存する
1. システムが成功メッセージを伝達する

###  削除に失敗(sad path):
1. システムからerrorを伝達する

###  保存に失敗(sad path):
1. システムからerrorを伝達する

---

## qiitaのユーザ画像をキャッシュする

### Data
- URL
- 画像データ

### Happy Path:
1. 「画像データを保存する」コマンドを実行する
2. システムが新しいキャッシュを保存する
3. システムが成功メッセージを伝達する

###  保存に失敗(sad path):
1. システムからerrorを伝達する

---

## リモートから取得済みのデータの次に最新のqiita情報を取得

### Data: 
- URL
- 画面に表示されている一番古いデータの更新日時

### Happy Path:
1. dataを使って「次のqiita情報を取得する」コマンドを実行する
1. システムがURLからデータをダウンロードする
1. システムがダウンロードデータをバリデーションする
1. システムが妥当なデータからqiita情報を作成する
1. システムがqiita情報を伝達する

### Invalid data(sad path):
1. システムからinvalid data errorを伝達する

### No connectivity(sad path):
1. システムからconnectivity errorを伝達する

---

## キャッシュから取得済みのデータの次に最新のqiita情報を取得

### Data: 
- 画面に表示されている一番古いデータの更新日時


### Happy Path:
1. dataを使って「次のqiita情報を取得する」コマンドを実行する
1. システムがキャッシュからデータを取得する
1. システムがキャッシュからqiita情報を作成する
1. システムがqiita情報を伝達する

###  取得に失敗(sad path):
1. システムからerrorを伝達する

### キャッシュが空(sad path):
1. システムからデータがないことを伝達する

---
